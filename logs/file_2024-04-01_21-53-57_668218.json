2024-04-01 21:53:57.673 | ERROR    | utils:create_customer:43 - What?!
Traceback (most recent call last):

  File "/home/azzlem/Proj/crm_bot/main.py", line 99, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x71d333f320c0>
    │       └ <function run at 0x71d337e07060>
    └ <module 'asyncio' from '/usr/lib/python3.11/asyncio/__init__.py'>

  File "/usr/lib/python3.11/asyncio/runners.py", line 188, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x71d3341f3640>
           │      └ <function Runner.run at 0x71d337e07420>
           └ <asyncio.runners.Runner object at 0x71d3343e8b90>
  File "/usr/lib/python3.11/asyncio/runners.py", line 120, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/azzlem/Proj/crm_bot/main.py:95> wait_for=<Future pending cb=[Task.t...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x71d337e04f40>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x71d3343e8b90>
  File "/usr/lib/python3.11/asyncio/base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x71d337e04ea0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.11/asyncio/base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x71d337e06ca0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.11/asyncio/base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x71d337f45120>
    └ <Handle <TaskStepMethWrapper object at 0x71d334020d00>()>
  File "/usr/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x71d334020d00>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x71d334020d00>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x71d334020d00>()>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x71d33445df90'>, 'bots': (<aiogram.client.bot.Bot object at 0x71d33445d650>,)}
                     │    │           │    └ Update(update_id=890042360, message=None, edited_message=None, channel_post=None, edited_channel_post=None, message_reaction=...
                     │    │           └ <aiogram.client.bot.Bot object at 0x71d33445d650>
                     │    └ <function Dispatcher.feed_update at 0x71d33575f9c0>
                     └ <Dispatcher '0x71d33445df90'>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x71d33575e200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x71d333f3e650>
                     └ <Dispatcher '0x71d33445df90'>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x71d33445df90'>, 'bots': (<aiogram.client.bot.Bot object at 0x71d33445d650>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=890042360, message=None, edited_message=None, channel_post=None, edited_channel_post=None, message_reaction=...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x71d333f3eb50>, functools.par...
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 27, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x71d33445df90'>, 'bots': (<aiogram.client.bot.Bot object at 0x71d33445d650>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=890042360, message=None, edited_message=None, channel_post=None, edited_channel_post=None, message_reaction=...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x71d333f3ebd0>, <function TelegramEventObserver.tri...
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram/fsm/middleware.py", line 41, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x71d33445df90'>, 'bots': (<aiogram.client.bot.Bot object at 0x71d33445d650>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=890042360, message=None, edited_message=None, channel_post=None, edited_channel_post=None, message_reaction=...
                 └ <function TelegramEventObserver.trigger at 0x71d333f5a980>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x71d33445df90'>, 'bots': (<aiogram.client.bot.Bot object at 0x71d33445d650>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=890042360, message=None, edited_message=None, channel_post=None, edited_channel_post=None, message_reaction=...
                 └ <function CallableObject.call at 0x71d333f5a8e0>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x71d33445df90'>>, Update(update_id=890042360, mess...
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x71d33445df90'>, 'bots': (<aiogram.client.bot.Bot object at 0x71d33445d650>,), 'bot': <aiogram.c...
                 │    │                           │                  └ CallbackQuery(id='2780810566237030066', from_user=User(id=647457914, is_bot=False, first_name='Александр', last_name='Сидорен...
                 │    │                           └ 'callback_query'
                 │    └ <function Router.propagate_event at 0x71d33575efc0>
                 └ <Dispatcher '0x71d33445df90'>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x71d33445df90'>, 'bots': (<aiogram.client.bot.Bot object at 0x71d33445d650>,), 'bot': <aiogram.c...
                 │        │                     │               └ CallbackQuery(id='2780810566237030066', from_user=User(id=647457914, is_bot=False, first_name='Александр', last_name='Сидорен...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x71d333f32480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x71d33575e200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x71d333f3c910>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 123, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x71d33575f060>
                 └ <Dispatcher '0x71d33445df90'>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x71d33445df90'>, 'bots': (<aiogram.client.bot.Bot object at 0x71d33445d650>,), 'bot': <aiogram.c...
                     │      │                           │                  └ CallbackQuery(id='2780810566237030066', from_user=User(id=647457914, is_bot=False, first_name='Александр', last_name='Сидорен...
                     │      │                           └ 'callback_query'
                     │      └ <function Router.propagate_event at 0x71d33575efc0>
                     └ <Router '0x71d33533eb10'>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x71d33445df90'>, 'bots': (<aiogram.client.bot.Bot object at 0x71d33445d650>,), 'bot': <aiogram.c...
                 │        │                     │               └ CallbackQuery(id='2780810566237030066', from_user=User(id=647457914, is_bot=False, first_name='Александр', last_name='Сидорен...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x71d333f323e0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x71d33575e200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x71d33401e090>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram_dialog/context/intent_middleware.py", line 186, in process_callback_query
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x71d33445df90'>, 'bots': (<aiogram.client.bot.Bot object at 0x71d33445d650>,), 'bot': <aiogram.c...
                 │       └ CallbackQuery(id='2780810566237030066', from_user=User(id=647457914, is_bot=False, first_name='Александр', last_name='Сидорен...
                 └ functools.partial(<aiogram_dialog.manager.manager_middleware.BgFactoryMiddleware object at 0x71d33404de50>, <function Router....
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram_dialog/manager/manager_middleware.py", line 77, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x71d33445df90'>, 'bots': (<aiogram.client.bot.Bot object at 0x71d33445d650>,), 'bot': <aiogram.c...
                 │       └ CallbackQuery(id='2780810566237030066', from_user=User(id=647457914, is_bot=False, first_name='Александр', last_name='Сидорен...
                 └ <function Router.propagate_event.<locals>._wrapped at 0x71d3336f4180>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 123, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x71d33575f060>
                 └ <Router '0x71d33533eb10'>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x71d33445df90'>, 'bots': (<aiogram.client.bot.Bot object at 0x71d33445d650>,), 'bot': <aiogram.c...
                     │      │                           │                  └ CallbackQuery(id='2780810566237030066', from_user=User(id=647457914, is_bot=False, first_name='Александр', last_name='Сидорен...
                     │      │                           └ 'callback_query'
                     │      └ <function Router.propagate_event at 0x71d33575efc0>
                     └ <Dialog(<StatesGroup 'Order'>)>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x71d33445df90'>, 'bots': (<aiogram.client.bot.Bot object at 0x71d33445d650>,), 'bot': <aiogram.c...
                 │        │                     │               └ CallbackQuery(id='2780810566237030066', from_user=User(id=647457914, is_bot=False, first_name='Александр', last_name='Сидорен...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x71d3336f4220>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x71d33575e200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x71d33402ead0>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 123, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x71d33575f060>
                 └ <Dialog(<StatesGroup 'Order'>)>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x71d33445df90'>, 'bots': (<aiogram.client.bot.Bot object at 0x71d33445d650>,), 'bot': <aiogram.c...
                     │        │       └ CallbackQuery(id='2780810566237030066', from_user=User(id=647457914, is_bot=False, first_name='Александр', last_name='Сидорен...
                     │        └ <function TelegramEventObserver.trigger at 0x71d33575e340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x71d33402ead0>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x71d33445df90'>, 'bots': (<aiogram.client.bot.Bot object at 0x71d33445d650>,), 'bot': <aiogram.c...
                 │             └ CallbackQuery(id='2780810566237030066', from_user=User(id=647457914, is_bot=False, first_name='Александр', last_name='Сидорен...
                 └ functools.partial(<aiogram_dialog.manager.manager_middleware.ManagerMiddleware object at 0x71d33404dc10>, functools.partial(<...
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram_dialog/manager/manager_middleware.py", line 52, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x71d33445df90'>, 'bots': (<aiogram.client.bot.Bot object at 0x71d33445d650>,), 'bot': <aiogram.c...
                 │       └ CallbackQuery(id='2780810566237030066', from_user=User(id=647457914, is_bot=False, first_name='Александр', last_name='Сидорен...
                 └ functools.partial(<function context_saver_middleware at 0x71d3352711c0>, <function CallableObject.call at 0x71d33362a340>)
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram_dialog/context/intent_middleware.py", line 198, in context_saver_middleware
    result = await handler(event, data)
                   │       │      └ {'dispatcher': <Dispatcher '0x71d33445df90'>, 'bots': (<aiogram.client.bot.Bot object at 0x71d33445d650>,), 'bot': <aiogram.c...
                   │       └ CallbackQuery(id='2780810566237030066', from_user=User(id=647457914, is_bot=False, first_name='Александр', last_name='Сидорен...
                   └ <function CallableObject.call at 0x71d33362a340>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dialog._callback_handler of <Dialog(<StatesGroup 'Order'>)>>, CallbackQuery(id='2780810566237...
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram_dialog/dialog.py", line 145, in _callback_handler
    await window.process_callback(cleaned_callback, self, dialog_manager)
          │      │                │                 │     └ <aiogram_dialog.manager.manager.ManagerImpl object at 0x71d333489a90>
          │      │                │                 └ <Dialog(<StatesGroup 'Order'>)>
          │      │                └ CallbackQuery(id='2780810566237030066', from_user=User(id=647457914, is_bot=False, first_name='Александр', last_name='Сидорен...
          │      └ <function Window.process_callback at 0x71d3352afd80>
          └ <Window(<State 'Order:user_choice'>)>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram_dialog/window.py", line 100, in process_callback
    await self.keyboard.process_callback(callback, dialog, manager)
          │    │        │                │         │       └ <aiogram_dialog.manager.manager.ManagerImpl object at 0x71d333489a90>
          │    │        │                │         └ <Dialog(<StatesGroup 'Order'>)>
          │    │        │                └ CallbackQuery(id='2780810566237030066', from_user=User(id=647457914, is_bot=False, first_name='Александр', last_name='Сидорен...
          │    │        └ <function Keyboard.process_callback at 0x71d3354d05e0>
          │    └ <aiogram_dialog.widgets.kbd.group.Group object at 0x71d33402e190>
          └ <Window(<State 'Order:user_choice'>)>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram_dialog/widgets/kbd/base.py", line 79, in process_callback
    return await self._process_other_callback(callback, dialog, manager)
                 │    │                       │         │       └ <aiogram_dialog.manager.manager.ManagerImpl object at 0x71d333489a90>
                 │    │                       │         └ <Dialog(<StatesGroup 'Order'>)>
                 │    │                       └ CallbackQuery(id='2780810566237030066', from_user=User(id=647457914, is_bot=False, first_name='Александр', last_name='Сидорен...
                 │    └ <function Group._process_other_callback at 0x71d3354480e0>
                 └ <aiogram_dialog.widgets.kbd.group.Group object at 0x71d33402e190>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram_dialog/widgets/kbd/group.py", line 74, in _process_other_callback
    if await b.process_callback(callback, dialog, manager):
             │ │                │         │       └ <aiogram_dialog.manager.manager.ManagerImpl object at 0x71d333489a90>
             │ │                │         └ <Dialog(<StatesGroup 'Order'>)>
             │ │                └ CallbackQuery(id='2780810566237030066', from_user=User(id=647457914, is_bot=False, first_name='Александр', last_name='Сидорен...
             │ └ <function Keyboard.process_callback at 0x71d3354d05e0>
             └ <aiogram_dialog.widgets.kbd.scrolling_group.ScrollingGroup object at 0x71d33402df10>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram_dialog/widgets/kbd/base.py", line 79, in process_callback
    return await self._process_other_callback(callback, dialog, manager)
                 │    │                       │         │       └ <aiogram_dialog.manager.manager.ManagerImpl object at 0x71d333489a90>
                 │    │                       │         └ <Dialog(<StatesGroup 'Order'>)>
                 │    │                       └ CallbackQuery(id='2780810566237030066', from_user=User(id=647457914, is_bot=False, first_name='Александр', last_name='Сидорен...
                 │    └ <function Group._process_other_callback at 0x71d3354480e0>
                 └ <aiogram_dialog.widgets.kbd.scrolling_group.ScrollingGroup object at 0x71d33402df10>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram_dialog/widgets/kbd/group.py", line 74, in _process_other_callback
    if await b.process_callback(callback, dialog, manager):
             │ │                │         │       └ <aiogram_dialog.manager.manager.ManagerImpl object at 0x71d333489a90>
             │ │                │         └ <Dialog(<StatesGroup 'Order'>)>
             │ │                └ CallbackQuery(id='2780810566237030066', from_user=User(id=647457914, is_bot=False, first_name='Александр', last_name='Сидорен...
             │ └ <function Keyboard.process_callback at 0x71d3354d05e0>
             └ <aiogram_dialog.widgets.kbd.select.Select object at 0x71d33402ded0>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram_dialog/widgets/kbd/base.py", line 73, in process_callback
    return await self._process_item_callback(
                 │    └ <function Select._process_item_callback at 0x71d335458540>
                 └ <aiogram_dialog.widgets.kbd.select.Select object at 0x71d33402ded0>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram_dialog/widgets/kbd/select.py", line 119, in _process_item_callback
    await self.on_click.process_event(
          │    │        └ <function SimpleEventProcessor.process_event at 0x71d3354b6480>
          │    └ <aiogram_dialog.widgets.widget_event.SimpleEventProcessor object at 0x71d33402df90>
          └ <aiogram_dialog.widgets.kbd.select.Select object at 0x71d33402ded0>
  File "/home/azzlem/Proj/crm_bot/.venv/lib/python3.11/site-packages/aiogram_dialog/widgets/widget_event.py", line 34, in process_event
    await self.callback(event, source, manager, *args, **kwargs)
          │    │        │      │       │         │       └ {}
          │    │        │      │       │         └ ('1',)
          │    │        │      │       └ <aiogram_dialog.manager.manager.ManagerImpl object at 0x71d333489a90>
          │    │        │      └ <aiogram_dialog.widgets.kbd.select.Select object at 0x71d33402ded0>
          │    │        └ CallbackQuery(id='2780810566237030066', from_user=User(id=647457914, is_bot=False, first_name='Александр', last_name='Сидорен...
          │    └ <function select_user at 0x71d334014720>
          └ <aiogram_dialog.widgets.widget_event.SimpleEventProcessor object at 0x71d33402df90>

  File "/home/azzlem/Proj/crm_bot/handlers/dialog_p/orders.py", line 63, in select_user
    customer = await CreateOrderFull.create_customer(data=dialog_manager.dialog_data, customer=None)
                     │               │                    │              └ <property object at 0x71d335297ba0>
                     │               │                    └ <aiogram_dialog.manager.manager.ManagerImpl object at 0x71d333489a90>
                     │               └ <staticmethod(<function CreateOrderFull.create_customer at 0x71d3340142c0>)>
                     └ <class 'utils.CreateOrderFull'>

> File "/home/azzlem/Proj/crm_bot/utils.py", line 35, in create_customer
    if data['customer'] is None:
       └ DataClass(data={'name': 'ОООПиськинХуй', 'phone': '7771119', 'address': 'ебенево 67', 'vendor': 'XIAOMI', 'model': 'bvk-555',...

TypeError: 'DataClass' object is not subscriptable
